var map,infowindow="",markers=[],locstart={lat:"47.609000",lng:"-122.340000"},fsBaseUrl="https://api.foursquare.com/v2/venues/search",foursquare={client_id:"EEVVE4BBS22Q3EHRZL33XVFZZTR51RZTZDIZXDDRVYPRPR4Y",client_secret:"25D03XWWJAVIJNYLJGJX3EH13HUUX3GJPM3WAVB1G30DOOVK",limit:"1",v:"20180323",ll:locstart.lat+","+locstart.lng,query:""};function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:locstart.lat,lng:locstart.lng},zoom:18,mapTypeId:"roadmap",mapTypeControl:!1}),infowindow=new google.maps.InfoWindow;for(var e="images/red_pin.png",o=0;o<locations.length;o++){var t=new google.maps.Marker({position:locations[o].location,title:locations[o].title,animation:google.maps.Animation.DROP,icon:e,id:o});markers.push(t),t.addListener("click",function(){animateMarker(this),populateInfoWindow(this,infowindow)}),t.addListener("mouseover",function(){this.setIcon("images/red_pin_bright.png")}),t.addListener("mouseout",function(){this.setIcon(e)})}showLocations()}function animateMarker(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)}.bind(self),2e3)}function populateInfoWindow(e,a){a.marker!=e&&(a.setContent(""),a.marker=e,a.addListener("closeclick",function(){a.marker=null}),foursquare.query=e.title,$.getJSON(fsBaseUrl,foursquare).done(function(e){var o=e.response.venues[0],t="";o.contact.phone&&(t='<a href="tel:+1'+o.contact.phone+'">'+o.contact.formattedPhone+"</a>");var n="";o.url&&(n="<a href="+o.url+'">'+o.url+"</a>"),a.setContent("<h4>"+o.name+"</h4><h6>("+o.categories.map(function(e){return e.shortName}).join(",")+")</h6><address>"+o.location.formattedAddress.join("<br>")+"</address><br>"+t+"<br>"+n+'<footer>Powered by <a href="https://developer.foursquare.com">Foursquare</a></footer>')}).fail(function(e,o,t){alert("Something went wrong with the foursquare API, please try again: "+t)}),a.open(map,e))}function showLocations(){for(var e=new google.maps.LatLngBounds,o=0;o<markers.length;o++)markers[o].setMap(map),e.extend(markers[o].position);map.fitBounds(e)}function markersSet(e){for(var o=0;o<markers.length;o++)markers[o].setVisible(e)}var Location=function(e,o){this.title=ko.observable(e.title),this.location=ko.observable(e.location),this.type=ko.observable(e.type),this.description=ko.observable(e.description),this.index=o,this.heading="heading"+o,this.collapse="collapse"+o};function listViewModel(){var n=this;n.locationList=ko.observableArray([]),n.searchNeighborhood=ko.observable("");for(var e=0;e<locations.length;e++){var o=new Location(locations[e],e);n.locationList.push(o)}n.popup=function(e){animateMarker(markers[e.index]),populateInfoWindow(markers[e.index],infowindow)},n.locationListFiltered=ko.computed(function(){if(markersSet(!1),!n.searchNeighborhood())return markersSet(!0),n.locationList();var o=[],t=0;return ko.utils.arrayForEach(n.locationList(),function(e){0===e.title().search(new RegExp(n.searchNeighborhood(),"i"))&&(o.push(e),markers[t].setVisible(!0)),t++}),o},this)}var listView={viewModel:new listViewModel};ko.applyBindings(listView.viewModel);